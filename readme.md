# Services

Various services for managing overlay and tts using zmq for ipc.

## `status_overlay.py`

An OBS script that updates the test source named "Status Text" with pre-scripted messages and messages received via ipc.

## `bs_listener.py`

Connects to the beat saber plus overlay socket and sends new map info to `status_overlay`.

## `tts_listener.py`

Text-to-speech listener receives messages, renders them to audio, and plays them.

Uses pyttsx3, but there's cruft around for supporting gtts (see `tts.py` and despair). 

## `chatbot.py`

Reads a chat and sends messages to `tts_listener`. Somewhat legacy. Includes various features.

Based on https://github.com/twitchdev/chatbot-python-sample

To use, create a secrets.py from the provided secrets_template.py with the username, client_id, and token filled in accordingly.

```
> python chatbot.py [channel name]
```

## `stt_listener.py`

Speech-to-text listener monitors a microphone for intelligible speech and sends the results to `tts_listener` and `status_overlay`

You'll have to manually tell it which microphone to use, and that might break if the default mic changes. I'm not sure what the deal is, but I find that I need to make sure everything else (steamvr etc) is up and running before starting this one.

Uses SpeechRecognition and `recognize_google`, which I hear might break if something something api keys whatever.

# Tools

## `terminal_client.py`

This is a very simple cli for sending ipc commands to the tts and overlay.

```
Commands:
  log <level> <message>
  tts <message>
  stt <message>
  help
  exit/quit
```

# Pythons

## `ipc.py`

Provides tools for ipc between services. `tts_listener` and `status_overlay` run servers that can receive various commands. The ports (7852 and 7854) are defined in `ipc.py` and can be used directly via `ipc.Client`, but there are helper classes that provide functions for sending all supported commands.

### `ipc.OverlayClient` 

Sends messages to the `status_overlay` server. 

`send_log` sends a message that will be displayed as `[<LOG LEVEL>] <message>`. 

`send_map` sends a list of strings providing info about a map and will be rendered with a divider.

### `ipc.TTSClient` 

Sends messages to the `tts_listener` server.

`send_chat` sends twitch chat messages to be rendered and is fairly legacy. It's used in `chatbot.py`.

`send_stt` sends a simple string as generated by `stt_listener` and renders it without all the bells and whistles of a twitch chat message. It also renders it with hardcoded voices defined in `tts.AISpeechSnippet`.

## `tts.py`, `message.py`, and `filter.py`

Some kind of overgrown tts abstraction layer originally meant to be used directly in `chatbot.py`. Good luck. `message.py` as something to do with processing messages into snippets that can be rendered in different ways. `filter.py` is used to automatically replace chunks of messages.

